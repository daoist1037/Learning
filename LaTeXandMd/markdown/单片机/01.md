## 硬件组成

+ 8位微处理器（CPD）；
+ 数据存储器（128B RAM）；
+ 程序存储器（4KB Flash ROM）；
+ 4个8位并行I/O口；
+ 1个全双工异步串口；
  + 全双工：两端各有两个端口相互连接，两个通道可同时传输
  + 半双工：两端各有两个端口相互连接，两个通道不能同时传输
  + 单工：单向
+ 2个16位定时器/计数器；
+ 1个看门狗定时器；
+ 中断系统：5个中断系、5个中新向至；
+ 特球功线穿存器（SFR）26个；
+ 低功耗的空闲模式和护电模式；
+ 3个程序加密位； 
相比AT89C51，AT89S51有更突出的优点：
+ 增加在线可编程功能ISP（In Systen Program），现场程序调试和修改更加方便灵活：
+ 数据指针2个，方便对片外RAM的访问过程：
+ 看门狗定时器，提高系统抗干抗能力；
+ 增加断电标志；
+ 增加掉电状态下的中断恢复模式；

CPU对各功能部件控制采用特殊功能寄存器（SFR，Special Function Register）的集中控制方式。
+ CPU（微处理器）
  + 8位，包括运算器和控制器两部分，还有位处理功能。
+ 数据存储器（RAM）
  + 128B（52系为256B），最可扩64KB，片内RAM为高速RAM可加快速度和降低功耗。
+ 程序存储器（Flash ROM）
  + 4KB Flash（AT89S52位8кB；AT89C55片内20KB），如不够片外可外扩至64KB.
+ 中断系统
  + 5个中断源，2级中断优先权。
+ 定时器/计数器
  + 2个16位定时器/计数器（52子系列有3个），4种工作方式。
+ 1个看门狗定时器WDT
  + 当CPU由于干扰使程序陷入死循环或跑飞时，WDT可使程序恢复正常运行。
+ 串行口
  + 全双工异步串行口，4种工作方式。可进行串行通信，扩展并行I/O口，可与多个单片机构成多机系统
+ P1口、P2口、P3口、P0口：4个8位并行I/O口
+ 特殊功能寄存器（**SFR**）
  + 26个，对片内各功能部件管理、控制和监视。是各功能部件的控制寄存器和状态寄存器，映射在片内RAM区80H~FFH内

## 引脚功能
多采用40只引脚双列直插


按功能可分为如下3类：
+ 电源及时钟引脚-**Vcc、Vss：XTAL1，XTAL2**
+ 控制引脚-**PSEN"、ALE/PROG"、EA*/Vpp，RST（RESET）**
+ I/O引脚-**PO，P1，P2、P3**，为4个8位I/O口。

### 电源及时钟引脚
+ 电源引脚
  + $Vcc$（40脚）：+5V电源。
  + $Vss$（20脚）：数字地。
+ 时钟引脚
  + $XTAL1$（19脚）：输入端。
    + 使用片内振荡器时，应接外部石英晶体和微调电容。外接时钟源时，该脚接外部时钟振荡器的信号。
  + $XTAL2$（18脚）：片内振荡器反相放大器的输出端。
    + 使用片内振荡器，该脚连接外部石英晶体和微调电容。
    + 当使用外部时钟源时，脚悬空。
+ 控制引脚
  + $RST（RESET，9脚）$
    + 复位信号输入，加持续时间大于2个机器周期的高电平，可使单片机复位。正常工作应$\leq$ 0.5V
    + 当看门狗定时器溢田输出时，该脚将输出长达96个时钟振荡周期的高电平。
  + $EA*/VPP$（Enable Address/Voltage Pulse of Programing 31脚）
    + $EA*$：第一功能：允许访问外部程序存储器控制。(*代表反，也即为低电平有效)
      + $EA*=1$
        + PC值$\leq$ `0FFFH`时，单片机读片内4KB Flash中的程序
        + PC值>0FFFH（超出片内4KB Flash地址范围）时，转向读取片外60KB（`1000H-FFFFH`）程序存储器空间中的程序。
      + $EA*=0$
        + 只读取外部的程序存储器中的内容，读取地址范围0000H~FFFH，片内4KB Flash无效。
    + $Vpp$：第二功能，对片内Flash编程，接编程电压。
  + $ALE/PROG*$（Address Latch Enable/PROGramming，30脚）
    + $ALE$：第一功能，为访问外部存储器提供低8位地址锁存信号，将低8位地址锁存在片外地址锁存器中。
      + 此外，单片机运行时，AE端一直有正k冲信号输出，频率为时钟的$f_{osc}$的1/6.
      + 注意，每当AT89551访问外部RAM时（执行MOVX类指令），要是失一个ALE冲.
    + $PROG*$：第二功能，对片内Flash编程的编程脉冲输入
  + $PSEN$（Program Strobe ENable，29脚）
    + 片外程序存储器读选通信号，低有效。
+ 并行I/O引脚
  + PO口：8位，漏极开路的双向I/O口
    + 可作为系统总线低8位地址总线及数据总线分时复用端口。
    + 也可作通用I/O口，需加上拉电阻，这时为准双向口。
    + 如作通用I/O输入，应先向端口写入1，可驱动8个LS型TTL负载
    + (漏极，有三态，即有高阻态；准双向没有高阻态)
  + P1口：8位，准双向I/O口，具有内部上拉电阻。
    + **准双向I/O口，作为I/O输入时，应先向端口锁存器写1**
    + P1口可驱动4个LS型TTL负载。
    + P1.5/MOSI，P1.6/MISO 和P1.7/SCK可对片内Flash存储器串行编程和校验，它们分别是串行数据输入、输出和移位脉冲引脚。
  + P2口：8位，准双向I/O口，具有内部上拉电阻当外扩存储器及I/O口时，P2口输出高8位地址。
    + P2口也可作为通用I/O使用。当作输入时，应先向端口输出锁存器写1
    + 可驱动4个LS型TTL负载


## CPU
### 运算器
+ 功能：对操作数进行算术、逻辑和位操作运算。
+ 组成：算术逻辑运算单元ALU、累加器A、位处理器、程序状态字寄存器PSW及两个暂存器等。
  + **算术逻辑运算单元ALU**
    + 可对8位变量逻辑运算（与、或、异或、循环、求补和清零），还可算术运算（加、减、乘、除）
    + ALU还有位操作功能，对位变量进行位处理，如置"1"、清“0"、求补、测试转移及逻辑“与”、“或”等。
  + **累加器A**
    + 使用最频繁的寄存器，可写为Acc."A"与"Acc"书写的差别，将在第3章介绍。
    + ALU单元的输入数据源之一，又是运算结果存放单元
    + 数据传送多通过A，数据中转站。为解决“瓶颈堵塞”问题，AT89S51增加了一部分可不经过累加器的传送指令。
    + A进位标志Cy同时又是位处理机的位累加器
  + **程序状态字寄存器PSW** PSW（Program Status Word）
    + 位于片内特殊功能寄存器区，字节地址为`DOH`。
      + 特殊功能寄存器区地址 `80H~FFH`
    + 包含**程序运行的状态信息**，其中4位保存当前指令执行后的状态，供查询和判断。

|     | D7  | D6  | D5  | D4  | D3  | D2  | D1  | D0  |     |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| PSW | Cy  | Ac  | F0  | RS1 | RS0 | OV  | ——  | P   | D0H |


+ **PSW各位功能**：
  1. **Cy(PSW.7)** 进标志位
    + 可写为C。在算术和逻辑运算时，若有进位/借位，Cy=1；否则，Cy=0。在位处理器中，它是位累加器。
  2. **Ac(PSw.6)** 辅助进位标志
     + 在BCD码运算时，用作十进位调整。即当D3位向D4位产生进位借位时，Ac=1；否则，Ac=0.
  3. **FO（PSW.5）** 用户设定标志位
     + 由用户使用的一个状态标志位，用指令使它置"1"或清"0"，控制程序流向，应充分利用。
  4. **RS1，RS0（PSW.4，PSW.3）** 4组I作寄存器区
     + 择选择片内RAM区中的4组工作寄存器区中的某一组为当前工作寄存区
  5. **ov（PSW.2）** 溢出标志位
     + 当执行算术指令时，用来指示运算结果是否产生溢出。如溢出，0V-1；否则，OV=0.
  6. **PSW.1**位：保留位
  7. **P（PSw.0）** 奇偶标志位
     + 指令执行完，A中"1"的个数是奇数还是偶


### 控制器
+ 任务：识别指令，控制单片机各功能部件，保证各部分自动协调工作。
+ 控制器包括：PC、指令寄存器、指令译码器、定时及控制逻辑电路等。
  + 功能：控制指令的读入、译码和执行，对各功能部件进行定时和逻辑控制。
  + 程序计数器PC是一个独立的16位计数器，不可访问。单片机复位时，PC内容为0000H，从程序存储器0000H单元取指令，执行程序。
  + PC工作过程：CPU取指令时，PC内容为所取指令的地址，程序存储器按此地址输出指令字节，同时PC自动加1。
  + PC中内容变化轨迹决定程序流程。
    + 当顺序执行程序，PC自动加1；
    + 执行转移程序或子程序、中断子程序调用时，自动将其内容更改成所要转移的目的地址。
  + PC计数宽度决定程序存储器地址范围。PC为16位，可对64KB（=$2^{15}$B）寻址。
+ AT89S51存储器的结构结构特点之一
  + 是**哈佛结构**，有各自的访问指令。
    + 哈弗结构，程序空间和数据空间分开
    + （与普林斯顿结构也叫冯诺伊曼结构，是一种将程序指令存储器和数据存储器合并在一起的存储器结构
  + 存储器空间分**4类**
    1. **程序存储器空间**
       1. 片内和片外两部分。
       2. 片内4KB Flash，编程和擦除完全是电气实现。可用通用编程器对其编程，也可在线编程。
       3. 当片内4KB Flash存储器不够用时，可外扩，最多可扩展至64KB程序存储器。
    2. **数据存储器空间**
       1. 片内与片外两部分。
       2. 片内有128B RAM（52子系列为256B）。
       3. 片内RAM不够用时，在片外可扩展至64KB RAM
    3. 特殊功能寄存器SFR（Special Function Register）
       1. 各功能部件的控制寄存器及状态寄存器。SFR综合反映了整个单片机基本系统内部实际的工作状态及工作方式。
    4. 位地址空间
       1. 211个可寻址位。片内RAM（共128位）+SFR区（共83位）。
#### 程序存储器空间
存程序和表格的固定常数。片内为4KB的Flash，地址为0000~0FFFH，16位地址线。外扩的程序存储器空间最大为64KB，地址为0000H~FFFFH，使用应注意
+ 片内和片外两部分，访问片内还是片外程序存储器，
  + 由EA*脚电平确定。
    + EA*=1，CPU从片内0000H开始取指令，当PC值没有超出0FFFE时，只访问片内Flash，当PC值超出0FFFH自动转向读片外程序存储器1000H~FFFFH内的程序。
    + EA*=0，不理会片内4KB Flash存储器，只执行片外程序存储器（0000H~FFFFH）中的程序。
+ 程序存储器5个固定单元为各中断源中断入口。
**5个中断源的中断入口地址**
| 中断源    | 入口地址 |
| --------- | -------- |
| 外部中断0 | 0003H    |
| 定时器T0  | 000BH    |
| 外部中断1 | 0013H    |
| 定时器T1  | 001BH    |
| 串行口    | 0023H    |
#### 数据存储器空间
+ 片内与片外
+ 片内RAM
  + 共128个单元 字节地址为 00H~7FH
    + 00H-1FH 4组通用工作寄存器区，每区包含8B，为R7~RO，可用指令改变RS1，RSO两位来选择。
    + 20H~2FH的16个单元的128位可位寻址，也可字节寻址。
    + 30H~7FH的单元只能字节寻址，用作存数据以及作为堆栈区。
+ 片外数据存储器
  + 当片内RAM不够用时，需扩，最多可外扩64KB的RAM.
  + 注意，片内RAM与片外RAM两个空间是相互独立的，片内RAM与片外RAM的低128B的地址是相同的，但由于使用的是不同的访问指令，所以不会发生冲突。
+ 特殊功能寄存器（SFR）
  + 映射在片内RAM的 80H-FFH区域中，共26个。SFR的名称及分布见表2-4。有些可位寻址
  + 与AT89051相比，新增5个SFR：DP1L，DP1H，AUXR，AUXR1和WDTRST，已在表2-4中标出。
  + 凡是可位寻址的SFR，字节地址末位只能是0H或8H.
  + 若读/写未定义单元，将得到一个随机数。


+ 堆栈指针SP——指示栈顶在内部RAM中的位置。
  + 堆栈向上生长。单片机复位后，SP为07H，堆栈从08H单元开始，由于08H~1FH单元分别是属于1~3组的工作寄存器区，最好在复位后把SP值改置为60H或更大的值，避免堆栈与工作寄存器冲突。
  + 堆栈主要为子程序调用和中断操作而设。保护断点和现场
  + 保护断点。无论子程序调用还是中断服务子程序调用，最终都要返回主程序。应预先把主程序断点在堆栈中保护起来，为程序正确返回做准备。
  + 现场保护。执行子程序或中断服务子程序时，要用到一些寄存器单元，会破坏原有内容。要把有关寄存器单元的内容保存起来，送入堆栈，这就是所谓的“现场保护”
    + 两种操作：数据压入（PUSH）堆栈，数据弹出（POP）堆栈。
+ 寄存器B
  + 为执行乘和除而设。不执行乘、除的情况下，可把它当作一个普通寄存器来使用。
  + 乘法，两乘数分别在A、B中，执行乘法指令后，乘积在BA中
  + 除法，被除数取自A，除数取自B，商存放在A中，余数存B中。（A/B）
+ AUXR寄存器
  + 辅助寄存器

|      | D7  | D6  | D5  | D4     | D3     | D2  | D1  | D0     |     |
| ---- | --- | --- | --- | ------ | ------ | --- | --- | ------ | --- |
| AUXR | -   | -   | -   | WDIDLE | DISRTO | -   | -   | DISALE | 8EH |


+ DISALE：ALE的禁止/允许位。
  + 0：ALE有效，发出脉冲；
  + 1：ALE仅在执行MOVC和MOVX类指令时有效，不访问外部存储器时，ALE不输出脉冲信号；
+ DISRTO：禁止/允许WDT溢出时的复位输出。
  + 0：WDT溢出时，在RST引脚输出一个高电平脉冲；
  + 1：RST引脚仅为输入脚。
+ WDIDLE：WDT在空闲模式下的禁止/允许位。
  + 0：WDT在空闲模式下继续计数；
  + 1：WDT在空闲模式下暂停计数。


+ 数据指针DPTRO和DPTRI
  + 双数据指针寄存器，便于访问数据存储器。
  + DPTRO：AT89C51单片机原有的数据指针，
  + DPTR1：新增加的数据指针。
  + AUXR1的DPS位用于选择两个数据指针。
    + 当DPS=0时，选用DPTRO；
    + 当DPS=1时，选用DPTR1.
  + 数据指针可作为一个16位寄存器来用，也可作为两个独立的8位寄存器DPOH（或DP1H）和DPOL（或DPIL）来用。